<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Evan Peng"><link rel="alternative" href="/atom.xml" title="我的學習筆記" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>再探 git rebase - 我的學習筆記</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">我的學習筆記</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">文章</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2017-06-01T14:00:54.000Z">June 1, 2017</time><h1 class="post__title"><a href="/2017/06/01/git-rebase-adv/">再探 git rebase</a></h1><div class="post__main echo"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>Rebase</strong>還能用來修改特定分支線上任何一個版本的版本資訊，因為自己的開發習慣都是幾乎完成一個功能才commit，現在認識了<strong>Rebase</strong>後，以後就可以頻繁的commit並且隨時修改版本號，也不用擔心辛辛苦苦寫完的code因為意外而救不回來了XD</p>
<h2 id="範例-選擇一次貼上全部指令執行時，可能會因為命令延遲，造成最後的結果有誤"><a href="#範例-選擇一次貼上全部指令執行時，可能會因為命令延遲，造成最後的結果有誤" class="headerlink" title="範例 (選擇一次貼上全部指令執行時，可能會因為命令延遲，造成最後的結果有誤)"></a>範例 (選擇一次貼上全部指令執行時，可能會因為命令延遲，造成最後的結果有誤)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">mkdir git-rebase-demo</div><div class="line"></div><div class="line"><span class="built_in">cd</span> git-rebase-demo</div><div class="line">git init</div><div class="line"></div><div class="line"><span class="built_in">echo</span> 1 &gt; a.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Initial commit (a.txt created)"</span></div><div class="line"></div><div class="line">ping 127.0.0.1 -n 2 &gt;nul</div><div class="line"></div><div class="line"><span class="built_in">echo</span> 2 &gt; a.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Update a.txt to 2"</span></div><div class="line"></div><div class="line">ping 127.0.0.1 -n 2 &gt;nul</div><div class="line"></div><div class="line">:: 建立並切換到 branch1 分支</div><div class="line">git checkout -b branch1</div><div class="line"></div><div class="line"><span class="built_in">echo</span> b &gt; b.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Add b.txt"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> c &gt; c.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Add c.txt"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> 333 &gt; c.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Update c.txt to 333"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> d &gt; d.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Add d.txt"</span></div><div class="line"></div><div class="line">ping 127.0.0.1 -n 2 &gt;nul</div><div class="line"></div><div class="line">:: 切換到 master 分支</div><div class="line">git checkout master</div><div class="line"></div><div class="line"><span class="built_in">echo</span> 3 &gt; a.txt</div><div class="line">git add .</div><div class="line">git commit -m <span class="string">"Update a.txt to 3"</span></div></pre></td></tr></table></figure>
<p>我們用 SourceTree 查看儲存庫的 commit graph (版本線圖) 如下：<br><img src="/2017/06/01/git-rebase-adv/commit-graph.png" alt="commit-graph" title="commit-graph"></p>
<h2 id="Rebase-能做的事"><a href="#Rebase-能做的事" class="headerlink" title="Rebase 能做的事"></a>Rebase 能做的事</h2><p>上一篇筆記講的，除了可以將某個分支當成自己目前分支的「基礎版本」。除了這件事以外，還可以用來修改某個分支中「特定一段」歷程的紀錄，我們可以做的事情包括：</p>
<p>1.調換 commit 的順序<br>2.修改 commit 的訊息<br>3.插入一個 commit<br>4.編輯一個 commit<br>5.拆解一個 commit<br>6.壓縮一個 commit，且保留訊息紀錄<br>7.壓縮一個 commit，但丟棄版本紀錄<br>8.刪除一個 commit</p>
<h3 id="1-調換-commit-的順序"><a href="#1-調換-commit-的順序" class="headerlink" title="1.調換 commit 的順序"></a>1.調換 commit 的順序</h3><p><strong>首先，先切換到 branch1 分支 ( git checkout branch1 )</strong></p>
<p>到 SourceTree 查看版本線圖，然後我們先決定這個分支中想要執行 Rebase 的起點 (不一定要是分支的起始點，任何一版都可以)，決定之後，直接在 SourceTree 複製該版本的絕對名稱(也就是以 SHA1 雜湊過的 Git 物件ID)。從下圖你可以看到，我們先在該版本按下滑鼠右鍵，然後再點選 Copy SHA to Clipboard 即可將 id 複製到剪貼簿中：<br><img src="/2017/06/01/git-rebase-adv/rebase_start.png" alt="rebase_start" title="rebase_start"></p>
<p>然後我們執行 git rebase a0d2422284c742e410227e558958eb07f930963b<strong>(點選 Copy SHA to Clipboard 複製的id)</strong> -i</p>
<p>接著會跳出編輯器，並且讓我們編輯一系列「指令」，如下圖示：<br><img src="/2017/06/01/git-rebase-adv/git-rebase-i.png" alt="git-rebase-i" title="git-rebase-i"></p>
<p>如果什麼都不改，就是執行這一系列 pick 等動作，我們先來看第一行，區分成三個欄位，分別以「空白字元」間隔，分別如下：</p>
<p>1.pick 代表的是「命令」，底下註解的部分有一系列「命令」的名稱與簡寫，你寫 p 與 pick 都是一樣的意思。<br>2.5cc6638 代表的是要使用的 commit 物件編號(絕對名稱)。<br>3.剩下的文字則是這個版本的紀錄訊息摘要。</p>
<p>所以執行 Rebase 的時候，會先將我們目前 branch1 分支的最新版本(head)倒帶(rewind)到我們這次指定的分支起點(rewinding head)，在這個例子裡，我們指定的分支起點就是 a0d2422284c742e410227e558958eb07f930963b 這個節點。</p>
<p>這時我們用 git log 查看一下目前的版本紀錄，我們指定的那個版本，並不在我們的 Rebase 指令清單中。</p>
<p>我們再重看一次這幾個版本如下：<br><img src="/2017/06/01/git-rebase-adv/git-rebase-i.png" alt="git-rebase-i" title="git-rebase-i"><br>這裡的 pick 代表的功能是 use commit，也就是我們要用這個版本來 commit 新版本。也就是上一篇筆記講到的重新套用(replay)這個字，所以這幾個指令，就是讓我們在分支「倒帶」之後，重新用這幾個版本套用一次版本變更，而且重新套用的過程會沿用當時版本的變更紀錄。</p>
<p>現在我們先來嘗試「調換 commit 的順序」這個命令。</p>
<p>若要完成「調換 commit 的順序」的任務，我們只要很簡單的修改這份文字檔，把版本的前後順序對調即可，例如我們修改成：<br><img src="/2017/06/01/git-rebase-adv/change-commit-order.png" alt="change-commit-order" title="change-commit-order"></p>
<p>後存檔退出，我們看看指令最後的執行結果為何，可以發現，我們這兩個版本真的順序對調了：<br><img src="/2017/06/01/git-rebase-adv/after-git-rebase-i.png" alt="after-git-rebase-i" title="after-git-rebase-i"></p>
<img src="/2017/06/01/git-rebase-adv/rebase_start.png" alt="rebase_start" title="rebase_start">
<p>我們從 SourceTree 裡面看一下版本線圖，感覺上跟上面這張執｀rebase前圖好像差很多，但其實只有這兩個版本調換而已，線圖不太一樣的原因是時間序改變了，我想這應該是 SourceTree 的顯示邏輯跟時間序有關，才會讓這線圖變得跟之前差這麼多。</p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/Git/">Git</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2017 Evan Peng</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>