<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Evan Peng"><link rel="alternative" href="/atom.xml" title="我的學習筆記" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>箭號函式 - 我的學習筆記</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0;"><header class="head"><h1 class="head-title u-fl"><a href="/">我的學習筆記</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">文章</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2017-06-25T05:24:22.000Z">June 25, 2017</time><h1 class="post__title"><a href="/2017/06/25/es6-arrow-function/">箭號函式</a></h1><div class="post__main echo"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>自己再進一步了解ES6之前，最常看到的語法之一就是箭號函式了，<br>它給我的感覺就是很簡潔，也誤以為所有的函式都可以輕鬆的用這個語法取代，<br>結果當然是沒那麼理想…XD</p>
<h3 id="普通函式與箭號函式的對照"><a href="#普通函式與箭號函式的對照" class="headerlink" title="普通函式與箭號函式的對照"></a>普通函式與箭號函式的對照</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x,y</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> x + y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// versus</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> foo = <span class="function">(<span class="params">x,y</span>) =&gt;</span> x + y;</div></pre></td></tr></table></figure>
<p>由一個參數列（如果不止一個參數，就以（..）括起），後面接著 <strong>=&gt;</strong> 記號，再接著一個函式主體 (function body) 所構成。</p>
<p>主體只有在其中含有一個以上的運算式，或是主體僅由一個非運算式述句 (non-expresstion statement) 構成時，需要以 { .. } 圍起。如果只有一個運算式，而省略了周圍的 { .. } ，就會有一個隱含的 <strong>return</strong> 出現在運算式前面，如範例所示。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> f1 = <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">12</span>;</div><div class="line"><span class="keyword">var</span> f2 = <span class="function"><span class="params">x</span> =&gt;</span> x * <span class="number">2</span>;</div><div class="line"><span class="keyword">var</span> f3 = <span class="function">(<span class="params">x,y</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">var</span> z = x * <span class="number">2</span> + y;</div><div class="line">  y++;</div><div class="line">  x *= <span class="number">3</span>;</div><div class="line">  <span class="keyword">return</span> (x + y + z) / <span class="number">2</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="不只是較短的語法，還有這個-this"><a href="#不只是較短的語法，還有這個-this" class="headerlink" title="不只是較短的語法，還有這個(this)"></a>不只是較短的語法，還有這個(<strong>this</strong>)</h3><p><strong>=&gt;</strong> 函式與 <strong>this</strong> 繫結 (binding) 行為有緊密的關係。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> controller = &#123;</div><div class="line">  makeRequest: <span class="function"><span class="keyword">function</span>(<span class="params">..</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">    btn.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">// ..</span></div><div class="line">      self.makeRequest(..);</div><div class="line">    &#125;, <span class="literal">false</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因為 <strong>this</strong> 繫結是動態的，可以藉由 self 變數退回到了可預測的<font color="red">語彙 (lexical) 範疇</font>。<br>事件處理函式中<strong>this</strong>代表的是<strong>dom</strong>對象，不是windows。<a href="http://blog.csdn.net/aitangyong/article/details/43231111" target="_blank" rel="external">了解更多</a></p>
<p>可用 <strong>=&gt;</strong> 箭號函式來取代 var self = this<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> controller = &#123;</div><div class="line">  makeRequest: <span class="function"><span class="keyword">function</span>(<span class="params">..</span>)</span>&#123;</div><div class="line">    btn.addEventListener(<span class="string">"click"</span>, () =&gt; &#123;</div><div class="line">      <span class="comment">// ..</span></div><div class="line">      <span class="keyword">this</span>.makeRequest(..);</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在箭號函式內，<strong>this</strong> 繫結不是動態的，而是<font color="red">語彙 (lexical)</font> 的，它會<font color="red">從周圍的範疇繼承 <strong>this</strong></font>，所以使用前要考慮清楚，例如下面範例，<strong>this</strong> 會指向全域物件(global object)。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> controller = &#123;</div><div class="line">  makeRequest: <span class="function">(<span class="params">..</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// ..</span></div><div class="line">    <span class="keyword">this</span>.helper(..);</div><div class="line">  &#125;,</div><div class="line">  helperf: <span class="function">(<span class="params">..</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// ..</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">controller.makeRequest();</div></pre></td></tr></table></figure></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/ES6/">ES6</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2017 Evan Peng</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>